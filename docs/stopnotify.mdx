---
title: "StopNotify"
---

<Warning>
**Enable `StopNotify`**

This feature must be enabled in Nayax Core during the integration.
</Warning>

The `StopNotify `endpoint enables Spark to determine whether a card presented at the payment terminal while idle is authorized to stop an ongoing session. This is primarily used in Pre-Authorization flows, where the same card must be presented again to terminate the session and proceed to settlement.

Nayax will send the hashed card value and the last four digits captured earlier in the `/TransactionCallback`  and `/TransactionNotify`along with terminal identifiers. Providers need to validate whether this card matches an ongoing session on that terminal. A matching card should result in an Approved response; otherwise, the Spark integrator should return a Declined verdict.

This feature must be enabled via Nayax Core. If no response is received from the Spark integrator within 5 seconds, the flow will be considered a failure from the consumer's perspective.

## Request

Send a POST request to Spark`/spark/CancelTransaction` endpoint with the following body:

```json
{
 "StopSiteId": 4,
 "MachineId": 71234996,
 "HwSerial": "0434334921100366",
 "CardLast4Digits": "1234",
 "CardHash": "7f2082ba5dbccf706b6987e75b62083f65b5695bc2d8c827c3e46769d007a9e6",
 "CardUid": "1288528281124927",
 "ServiceStationNumber": "5"
}
```

### Request Parameters

The table below describes the parameters of the request:

<Table>
  <thead>
    <tr>
      <th>
        Field
      </th>

      <th>
        Type
      </th>

      <th>
        Required
      </th>

      <th>
        Description
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `StopSiteId`
      </td>

      <td>
        Integer
      </td>

      <td>
        Yes
      </td>

      <td>
        ID of the site where the card is presented to stop the session
      </td>
    </tr>

    <tr>
      <td>
        `MachineId`
      </td>

      <td>
        Integer
      </td>

      <td>
        Yes
      </td>

      <td>
        Unique ID of the vending machine or device
      </td>
    </tr>

    <tr>
      <td>
        `HwSerial`
      </td>

      <td>
        String
      </td>

      <td>
        Yes
      </td>

      <td>
        Hardware serial number of the terminal
      </td>
    </tr>

    <tr>
      <td>
        `CardLast4Digits`
      </td>

      <td>
        String
      </td>

      <td>
        Yes
      </td>

      <td>
        Last 4 digits of the payment card presented
      </td>
    </tr>

    <tr>
      <td>
        `CardHash`
      </td>

      <td>
        String
      </td>

      <td>
        Yes
      </td>

      <td>
        Hashed value of the card used during the original transaction
      </td>
    </tr>

    <tr>
      <td>
        `CardUid`
      </td>

      <td>
        String
      </td>

      <td>
        No
      </td>

      <td>
        Unique identifier of the card. See a more detailed explanation on the [SMC Support](https://developerhub.nayax.com/docs/smc-support)  page..
      </td>
    </tr>

    <tr>
      <td>
        `ServiceStationNumber`
      </td>

      <td>
        String
      </td>

      <td>
        Yes
      </td>

      <td>
        The identifier of the service station where the consumer wishes\
        to receive service from, selected from the Nayax Device display.
      </td>
    </tr>
  </tbody>
</Table>

## Response

A successful response will return the following body:

```json
{
  "SparkTransactionId": "12c7cec2-c690-4425-9a1f-db0db60e2d8c",
  "NayaxTransactionId": 2004545072,
  "SiteId": 2,
  "StopSiteId": 4,
  "MachineId": 71234996,
  "HwSerial": "0434334921100366",
  "MachineAuTime": "20240205194122328",
  "Status": {
    "Verdict": "Approved",
    "ErrorDescription": "No Errors"
  }
}
```

### Response Parameters

The table below describes the parameters of the response:

| Field                     | Type    | Description                                                                                                                             |
| :------------------------ | :------ | :-------------------------------------------------------------------------------------------------------------------------------------- |
| `SparkTransactionId`      | String  | The Spark session identifier for the matched transaction                                                                                |
| `NayaxTransactionId`      | Integer | Unique ID for the Nayax transaction                                                                                                     |
| `SiteId`                  | Integer | The original site where the transaction was initiated                                                                                   |
| `StopSiteId`              | Integer | The site where the card was presented to stop the session                                                                               |
| `MachineId`               | Integer | ID of the machine where the card was presented                                                                                          |
| `HwSerial`                | String  | Serial number of the machine                                                                                                            |
| `MachineAuTime`           | String  | Local machine timestamp of the authorization in the format `yyyyMMddHHmmssSSS`                                                          |
| `Status.Verdict`          | String  | Indicates whether the stop request was approved or declined                                                                             |
| `Status.ErrorDescription` | String  | Human-readable message with additional context if applicable                                                                            |
| `Status.ErrorCode`        | Number  | A numeric code indicating a specific type of error that occurred during the transaction. This field is present only in error responses. |