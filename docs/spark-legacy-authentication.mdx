---
title: "Legacy Authentication"
---

Spark uses a two-part security mechanism:

* Token-based identification to associate the request with your account.
* HMAC signature using a shared secret (`Sign Key`) to ensure the request body hasn’t been tampered with in transit.

This page will guide you to securely authenticate Spark API requests using Nayax’s custom HMAC signature mechanism. This involves signing each request body with a shared `Sign Key` and attaching two mandatory headers: `Signature `and `IntegratorId`.

## Prerequisites

Before you begin, make sure you have the following resources:

* A valid Sign Key (shared by Nayax, typically 16 characters)
* The associated Sign Key ID

<Warning>
**Mandatory**

This signature mechanism is required for all Spark endpoints. Requests without a valid signature will be rejected with `401 Unauthorized`.
</Warning>

## Authenticate Requests

Once you have the required resources, you can start authenticating your API requests to Spark by following the steps below:

1. Prepare the JSON body with all the necessary fields (e.g., `TerminalId`, `Cipher`, etc.). Here’s a simplified example for the [StartAuthentication](https://developerhub.nayax.com/reference/post_startauthentication) endpoint:

   ```json
   {
     "TokenlId": 116383,  
     "TerminalId": "0434334921100366",
     "TerminalIdType": 1,
     "Random": "123456789qwertyui",
     "Cipher": "X305dITNTAw2vHsxE+taVcn6UvgBC3fdI6QbqeABgHbo8CKsoZhqISJfslehCiA+L7XYrqvKFci7C6BNj/trzBuNJwBEjgBzKhhgpJ5ggnw="
   }

   ```
2. Serialize the JSON request content, removing whitespace and line breaks. Do not alter values or add escape characters unless they are part of the actual payload.

   <Frame><img src="/images/docs/spark-legacy-authentication/image1.png" /></Frame>

   We used this [JSON lint tool](https://jsonlint.com/) to do so in the example. The result is the following.

   ```json
   {"TokenlId":116383,"TerminalId":"0434334921100366","TerminalIdType":1,"Random":"123456789qwertyui","Cipher":"X305dITNTAw2vHsxE+taVcn6UvgBC3fdI6QbqeABgHbo8CKsoZhqISJfslehCiA+L7XYrqvKFci7C6BNj/trzBuNJwBEjgBzKhhgpJ5ggnw="}
   ```
3. Generate the `Signature` header following the steps below:
   1. Concatenate the serialized request and the Sign Key, separated by ";".
      ```json
      {"TokenlId":116383,...,"Cipher":"..."};RbtdDsiVNjkAeRty
      ```
   2. Hash the result using SHA-256 (UTF-8 encoded):

      <Frame><img src="/images/docs/spark-legacy-authentication/image2.png" /></Frame>

      We used [this tool](https://emn178.github.io/online-tools/sha256.html) to do so in the example. Use the output as your `Signature` header.

      ```json
      536a5813206bcb663d98715d10a6b2612364245c865cdd5f781ff4428c4a6137
      ```
4. Add the `IntegratorId `and `Signature `headers to your request.
   ```json
   curl -X POST https://api-sandbox.nayax.com/spark/StartAuthentication \
   --header 'IntegratorId: 927' \
   --header 'Signature: 536a5813206bcb663d98715d10a6b2612364245c865cdd5f781ff4428c4a6137' \
   --header 'Content-Type: application/json' \
   --data '{
     "TokenId": 116383,	
     "TerminalId": "0434334921100366",
     "TerminalIdType": 1,
     "Random": "123456789qwertyui",
     "Cipher": "X305dITNTAw2vHsxE+taVcn6UvgBC3fdI6QbqeABgHbo8CKsoZhqISJfslehCiA+L7XYrqvKFci7C6BNj/trzBuNJwBEjgBzKhhgpJ5ggnw="
   }'
   ```

For this example, the [`/StartAuthentication`](https://developerhub.nayax.com/reference/post_startauthentication)  method was used, but the process is relevant for any Spark endpoint request and response.

<Warning>
**UTF-8 Encoding**

Ensure the Signature is correctly generated from the minified JSON and UTF-8 hash.
</Warning>

### Build `cipher`

Your ciphertext combines the following:

* A 36-character Spark Transaction ID (a GUID with hyphens).
* A single "=" character.
* A 17-character alphanumeric Random String.
* A 10-character `YYMMDDhhmm` UTC Timestamp.

Follow these steps to generate and encrypt your cipher:

1. Concatenate the Spark Transaction ID, the "=" character, the Random String, and the Timestamp to form the 64-character ciphertext, as in the example below:
   ```
   12c7cec2-c690-4425-9a1f-db0db60e2d8c=123456789qwertyui2306061021
   ```
2. Extract the 32 rightmost characters from your provided Token to create the 256-bit AES encryption key. For example, suppose the token is the following:
   ```
   some_long_token_wRvTVTkungMIKThTVbj_fiXdfoGclhn0
   ```
   The encryption key is as follows:
   ```
   wRvTVTkungMIKThTVbj_fiXdfoGclhn0
   ```
3. Encrypt the 64-character ciphertext using AES in ECB mode. Ensure the plaintext is padded (e.g., using PKCS7) to a multiple of 16 bytes. Base64 encode the resulting encrypted bytes for transmission, which yields an output similar to the example below:
   ```
   X305dITNTAw2vHsxE+taVcn6UvgBC3fdI6QbqeABgHbo8CKsoZhqISJfslehCiA+L7XYrqvKFci7C6BNj/trzBuNJwBEjgBzKhhgpJ5ggnw=
   ```

## See Also

<HTMLBlock>
  {`
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

    .card_container {
      display: flex;
      gap: 10px;
      margin: 0 auto;
      max-width: var(--container-lg);
      width: 100%;
      flex-wrap: wrap;

      .card {
        display: flex;
        padding: 20px 14px;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        min-width: 190px;
        flex-shrink: 0;
        gap: 12px;
        border-radius: 6px;
        border: 1px solid #DCDCDC;
        background: #FFF;
        box-shadow: 0px 3.656px 27.422px 0px rgba(0, 0, 0, 0.13);
        text-decoration: none;
        flex-grow: 1;
        flex-basis: 0;
        text-decoration: none !important;

        svg {
          fill: none;

          rect {
            fill: #FFF;
            stroke: #C9C9C9;
          }

          path {
            fill: #d2a900;
          }
        }

        h3 {
          color: #383838;
          text-align: center;
          font-family: Inter !important;
          font-size: 17.5px;
          font-style: normal;
          font-weight: 700;
          text-decoration: none;
          margin: 0;
          text-align: start;
        }
      }

      .card:hover {
        cursor: pointer;
        border: 1px solid #d2a900 !important;
        box-shadow: 0px 4px 30px 0px rgba(0, 0, 0, 0.13);
        transform: translateY(-1px);

        svg {
          fill: none;

          rect {
            fill: #d2a900;
            stroke: #C9C9C9;
          }

          path {
            fill: #FFF;
          }
        }
      }
    }

    @media (prefers-color-scheme: dark) {
      [data-color-mode="system"] .card_container {
        .card {
          border: 1px solid #556974;
          background: #20292e;

          svg {
            rect {
              fill: #20292e;
              stroke: #556974;
            }
          }

          h3,
          p {
            color: #FFF;
          }
        }

        .card:hover {
          cursor: pointer;
          border: 1px solid #d2a900 !important;
          box-shadow: 0px 4px 30px 0px rgba(0, 0, 0, 0.13);
          transform: translateY(-1px);

          h3 {
            color: #d2a900;
          }

          svg {
            fill: none;

            rect {
              fill: #d2a900;
              stroke: #556974;
            }

            path {
              fill: #20292e;
            }
          }
        }
      }
    }

    [data-color-mode="dark"] .card_container {
      .card {
        border: 1px solid #556974;
        background: #20292e;

        svg {
          rect {
            fill: #20292e;
            stroke: #556974;
          }
        }

        h3,
        p {
          color: #FFF;
        }
      }

      .card:hover {
        cursor: pointer;
        border: 1px solid #d2a900 !important;
        box-shadow: 0px 4px 30px 0px rgba(0, 0, 0, 0.13);
        transform: translateY(-1px);

        h3 {
          color: #d2a900;
        }

        svg {
          fill: none;

          rect {
            fill: #d2a900;
            stroke: #556974;
          }

          path {
            fill: #20292e;
          }
        }
      }
    }

    @media only screen and (max-width: 450px) {
      .card_container {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }
  </style>

  <div class="card_container">

    <a class="card" href="/v1.0/docs/transaction-flows-spark">
      <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 33 33">
        <rect x="0.5" y="0.5" width="31.8205" height="31.8205" rx="3.70776" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M23.3736 24.9994C22.4754 24.9994 21.7472 24.2712 21.7472 23.373V11.2526L9.62638 11.2526C8.72816 11.2526 8 10.5245 8 9.62632C8 8.72813 8.72816 8 9.62639 8L23.3736 8C24.2718 8 25 8.72813 25 9.62632L25 23.373C25 24.2712 24.2718 24.9994 23.3736 24.9994Z" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M22.8056 10.1953C23.4408 10.8304 23.4408 11.8602 22.8056 12.4953L10.7768 24.5237C10.1416 25.1588 9.11188 25.1588 8.47674 24.5237C7.84159 23.8885 7.84159 22.8588 8.47673 22.2237L20.5056 10.1953C21.1407 9.56019 22.1705 9.56019 22.8056 10.1953Z" />
      </svg>
      <h3>Transaction Flows</h3>
    </a>

    <a class="card" href="/v1.0/docs/api-methods-spark">
      <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 33 33">
        <rect x="0.5" y="0.5" width="31.8205" height="31.8205" rx="3.70776" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M23.3736 24.9994C22.4754 24.9994 21.7472 24.2712 21.7472 23.373V11.2526L9.62638 11.2526C8.72816 11.2526 8 10.5245 8 9.62632C8 8.72813 8.72816 8 9.62639 8L23.3736 8C24.2718 8 25 8.72813 25 9.62632L25 23.373C25 24.2712 24.2718 24.9994 23.3736 24.9994Z" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M22.8056 10.1953C23.4408 10.8304 23.4408 11.8602 22.8056 12.4953L10.7768 24.5237C10.1416 25.1588 9.11188 25.1588 8.47674 24.5237C7.84159 23.8885 7.84159 22.8588 8.47673 22.2237L20.5056 10.1953C21.1407 9.56019 22.1705 9.56019 22.8056 10.1953Z" />
      </svg>
      <h3>API Methods</h3>
    </a>

  </div>
  `}
</HTMLBlock>