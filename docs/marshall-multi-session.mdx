---
title: "Multi-Session"
---

The **Multi-Session** payment flow separates the consumer interaction into two distinct parts:

1. **Product selection.**
2. **Authorization and settlement** of the consumerâ€™s card.

This differs from the Single-Session flow, in which settlement is performed immediately after product selection and authorization.

## Settlement timeout

<Callout icon="ðŸ“˜" theme="info">
  Settlement should occur anywhere between **1 minute and 71 hours** (the exact value depends on a parameter called **"Session timeout"** in Nayax Core) after authorization process was completed.

  Note that in case of the machine not sending a settlement command within a timeframe set in **"Session timeout"** parameter in Nayax Core- the device would settle the transaction on it's own and notify the peripheral about it via "Status" command.

  For VPOSM- it's possible to have the transaction be cancelled instead of settled in case of timeout- but that would be possible via additional configuration on Nayax Core (unrelated to the Marshall flow- meaning from Marshall's POV, the device would always try and settle the transaction at session timeout).
</Callout>

<Callout icon="â—ï¸" theme="error">
  It's important that peripherals do not count on the Session Timeout mechanism as it's strictly a fallback mechanism from the device's end.\
  Meaning the peripheral should always send a settlement command, and in case of not wanting to charge the consumer he can change one of the settlements fields, called "status" (unrelated to the "Status" command) to a status of "Vend failure" for example- more on that in [Multisession- not charging a consumer at settlement stage](https://developerhub.nayax.com/docs/faq-marshall-flowconfigurations#not-charging-consumers-close-session-with-price-of-0--what-is-the-issue)
</Callout>

## Why Use Multi-Session

The Multi-Session flow enables you to manage **multiple concurrent transactions** on a single device. It is ideal for peripherals with longer transaction times or those that serve several consumers simultaneously.

### Concurrent Transactions

This flow is applicable in environments such as **EV chargers**, where multiple consumers may use the same station simultaneously but require independent payment processing.

### Longer Transaction Times

Multi-Session is also helpful when the vending process is longer than the standard **4 minutes and 15 seconds**.

The flow allows the peripheral to notify the Nayax Device that vending can begin immediately after the card is authorized. The Nayax Device then waits for a later update from the peripheral regarding the final vend status or service stop, which enables settlement.

### Quicker Credit Release

The Multi-Session flow functions technically as a **Pre-Selection flow**. For some acquirers, this architecture can lead to a **quicker release of captured credit** than the Single-Session flow with Pre-Authorization.

If you use Single-Session with Pre-Authorization, the authorized credit amount may take days or weeks to be released, which can confuse consumers who may think they were charged the full Pre-Authorization amount. Multi-Session helps mitigate this issue.

## Payment Flow

The diagrams below illustrate the sequence of events within the Multi-Session payment flow.

<Callout icon="ðŸ“˜" theme="info">
  In this flow there are two parts to the transaction process, therefore the are two separate diagrams, one for each step.
</Callout>

<Frame><img src="/images/docs/marshall-multi-session/image1.jpg" /></Frame>

<Frame><img src="/images/docs/marshall-multi-session/image2.jpg" /></Frame>

Below is a breakdown of the diagram:

1. The Nayax Device sends a message to the consumer: "Please Select a Product."
2. The consumer selects a product for the vending machine.
3. The peripheral's SDK sends a vending request to the Nayax Device:
   ```c
   vmc_vend_vend_request(vend_session_t *session)
   ```
   ```csharp
   vmc_instance.vend.vend_request(session);
   ```
   ```java
   m_vmc.vend.vend_request(m_sessions[m_active_session]);
   ```
4. The Nayax Device sends a message to the consumer: "Please Present Card."
5. The consumer presents their payment card.
6. The Nayax Device sends an authorization request to the Nayax Server.
7. The Nayax Server forwards the authorization request to the Billing Provider.
8. The Billing Provider sends an authorization response (approved) to the Nayax Server.
9. The Nayax Server sends the authorization response (approved) back to the Nayax Device.
10. The peripheral's SDK handles transaction data received from the Nayax Device via Transfer Data (said data includes information about the Nayax transaction ID and the consumer's card details):
    ```c
    vmc_vend_event_handler_cb(vm_vend_event_on_transaction_info)
    ```
    ```csharp
    vend_callbacks(onTransactionInfo(data))
    ```
    ```java
    vmc_vend_events()
    (via onTransactionInfo(data))
    ```
11. The SDK triggers "Vend Approved" events:
    ```c
    vmc_vend_event_handler_cb(vm_vend_event_on_vend_approved)
    ```
    ```csharp
    vend_callbacks()
    (via onVendApproved(session))
    ```
    ```java
    vmc_vend_events()
    (via onVendApproved(session))
    ```
12. The peripheral starts dispensing the product/ providing the service to the consumer.
13. The SDK reports "vend success":
    ```c
    vmc_vend_vend_status(&session, __true)
    ```
    ```csharp
    vmc_vend_events()
    (via onVendApproved(session) -which would return "true")
    ```
    ```java
    vmc_vend_events()
    (via onVendApproved(session) -which would return "true")
    ```
    and completes the vend session:
    ```c
    vmc_vend_vend_session_complete_lowlevel()
    ```
    ```csharp
    no such function in C# or Java due to the nature of the languages
    ```
    ```java
    no such function in C# or Java due to the nature of the languages
    ```
14. The first part of the transaction **ends**.

<Frame><img src="/images/docs/marshall-multi-session/image3.png" /></Frame>

15. The machine finishes dispensing the product/providing the service.
16. Vending machine SDK settles the transaction (session):
    ```c
    vmc_vend_session_close(session)
    ```
    ```csharp
    vmc_instance.vend.session_close(session)
    ```
    ```java
    m_vmc.vend.session_close(session)
    ```
17. The Nayax Server forwards the settlement request to the Billing Provider.
18. The Billing Provider sends a settlement response (OK) to the Nayax Server.
19. Nayax Server returns the settlement response (OK) to the Nayax Device.
20. The peripheral's SDK receives a status command regarding the settlement (whether the device was able to settle it or not) and triggers a "settlement" event:
    ```c
    vmc_vend_event_handler_cb(vm_vend_event_on_settlement)
    ```
    ```csharp
    vmc_vend_events()
    (via onSettlement(success) -which would return "true")
    ```
    ```java
    vmc_vend_events()
    (via onSettlement(success) -which would return "true")
    ```
21. Vending machine SDK transfers data and triggers a "transaction info" event:
    ```c
    vmc_vend_event_handler_cb(vm_vend_event_on_transaction_info)
    ```
    ```csharp
    vmc_vend_events()
    (via onTransactionInfo(data))
    ```
    ```java
    vmc_vend_events()
    (via onTransactionInfo(data))
    ```
22. Message to the consumer: "Thank you & Goodbye."

## See also

<HTMLBlock>
  {`
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

    .card_container {
      display: flex;
      gap: 10px;
      margin: 0 auto;
      max-width: var(--container-lg);
      width: 100%;
      flex-wrap: wrap;

      .card {
        display: flex;
        padding: 20px 14px;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        min-width: 190px;
        flex-shrink: 0;
        gap: 12px;
        border-radius: 6px;
        border: 1px solid #DCDCDC;
        background: #FFF;
        box-shadow: 0px 3.656px 27.422px 0px rgba(0, 0, 0, 0.13);
        text-decoration: none;
        flex-grow: 1;
        flex-basis: 0;
        text-decoration: none !important;

        svg {
          fill: none;

          rect {
            fill: #FFF;
            stroke: #C9C9C9;
          }

          path {
            fill: #d2a900;
          }
        }

        h3 {
          color: #383838;
          text-align: center;
          font-family: Inter !important;
          font-size: 17.5px;
          font-style: normal;
          font-weight: 700;
          text-decoration: none;
          margin: 0;
          text-align: start;
        }
      }

      .card:hover {
        cursor: pointer;
        border: 1px solid #d2a900 !important;
        box-shadow: 0px 4px 30px 0px rgba(0, 0, 0, 0.13);
        transform: translateY(-1px);

        svg {
          fill: none;

          rect {
            fill: #d2a900;
            stroke: #C9C9C9;
          }

          path {
            fill: #FFF;
          }
        }
      }
    }

    @media (prefers-color-scheme: dark) {
      [data-color-mode="system"] .card_container {
        .card {
          border: 1px solid #556974;
          background: #20292e;

          svg {
            rect {
              fill: #20292e;
              stroke: #556974;
            }
          }

          h3,
          p {
            color: #FFF;
          }
        }

        .card:hover {
          cursor: pointer;
          border: 1px solid #d2a900 !important;
          box-shadow: 0px 4px 30px 0px rgba(0, 0, 0, 0.13);
          transform: translateY(-1px);

          h3 {
            color: #d2a900;
          }

          svg {
            fill: none;

            rect {
              fill: #d2a900;
              stroke: #556974;
            }

            path {
              fill: #20292e;
            }
          }
        }
      }
    }

    [data-color-mode="dark"] .card_container {
      .card {
        border: 1px solid #556974;
        background: #20292e;

        svg {
          rect {
            fill: #20292e;
            stroke: #556974;
          }
        }

        h3,
        p {
          color: #FFF;
        }
      }

      .card:hover {
        cursor: pointer;
        border: 1px solid #d2a900 !important;
        box-shadow: 0px 4px 30px 0px rgba(0, 0, 0, 0.13);
        transform: translateY(-1px);

        h3 {
          color: #d2a900;
        }

        svg {
          fill: none;

          rect {
            fill: #d2a900;
            stroke: #556974;
          }

          path {
            fill: #20292e;
          }
        }
      }
    }

    @media only screen and (max-width: 450px) {
      .card_container {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }
  </style>

  <div class="card_container">

    <a class="card" href="/v1.0/docs/marshall-payment-flows">
      <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 33 33">
        <rect x="0.5" y="0.5" width="31.8205" height="31.8205" rx="3.70776" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M23.3736 24.9994C22.4754 24.9994 21.7472 24.2712 21.7472 23.373V11.2526L9.62638 11.2526C8.72816 11.2526 8 10.5245 8 9.62632C8 8.72813 8.72816 8 9.62639 8L23.3736 8C24.2718 8 25 8.72813 25 9.62632L25 23.373C25 24.2712 24.2718 24.9994 23.3736 24.9994Z" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M22.8056 10.1953C23.4408 10.8304 23.4408 11.8602 22.8056 12.4953L10.7768 24.5237C10.1416 25.1588 9.11188 25.1588 8.47674 24.5237C7.84159 23.8885 7.84159 22.8588 8.47673 22.2237L20.5056 10.1953C21.1407 9.56019 22.1705 9.56019 22.8056 10.1953Z" />
      </svg>
      <h3>Payment Flows</h3>
    </a>

    <a class="card" href="/v1.0/docs/marshall-get-started">
      <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 33 33">
        <rect x="0.5" y="0.5" width="31.8205" height="31.8205" rx="3.70776" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M23.3736 24.9994C22.4754 24.9994 21.7472 24.2712 21.7472 23.373V11.2526L9.62638 11.2526C8.72816 11.2526 8 10.5245 8 9.62632C8 8.72813 8.72816 8 9.62639 8L23.3736 8C24.2718 8 25 8.72813 25 9.62632L25 23.373C25 24.2712 24.2718 24.9994 23.3736 24.9994Z" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M22.8056 10.1953C23.4408 10.8304 23.4408 11.8602 22.8056 12.4953L10.7768 24.5237C10.1416 25.1588 9.11188 25.1588 8.47674 24.5237C7.84159 23.8885 7.84159 22.8588 8.47673 22.2237L20.5056 10.1953C21.1407 9.56019 22.1705 9.56019 22.8056 10.1953Z" />
      </svg>
      <h3>Get Started</h3>
    </a>

    <a class="card" href="/v1.0/docs/marshall-methods-and-functions">
      <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 33 33">
        <rect x="0.5" y="0.5" width="31.8205" height="31.8205" rx="3.70776" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M23.3736 24.9994C22.4754 24.9994 21.7472 24.2712 21.7472 23.373V11.2526L9.62638 11.2526C8.72816 11.2526 8 10.5245 8 9.62632C8 8.72813 8.72816 8 9.62639 8L23.3736 8C24.2718 8 25 8.72813 25 9.62632L25 23.373C25 24.2712 24.2718 24.9994 23.3736 24.9994Z" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M22.8056 10.1953C23.4408 10.8304 23.4408 11.8602 22.8056 12.4953L10.7768 24.5237C10.1416 25.1588 9.11188 25.1588 8.47674 24.5237C7.84159 23.8885 7.84159 22.8588 8.47673 22.2237L20.5056 10.1953C21.1407 9.56019 22.1705 9.56019 22.8056 10.1953Z" />
      </svg>
      <h3>Methods & Functions</h3>
    </a>

  </div>
  `}
</HTMLBlock>



<br />